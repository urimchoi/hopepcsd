// Generated by CoffeeScript 1.7.1
(function() {
  var Sermon;

  Sermon = {
    getMoreSermons: function() {
      var sermonPage, stopRunning;
      sermonPage = 1;
      stopRunning = false;
      return $(window).scroll(function() {
        var el;
        if ($(window).scrollTop() + $(window).height() > 0.9 * $(document).height()) {
          if (!stopRunning) {
            el = $('#sermon-list');
            stopRunning = true;
            return $.ajax("ajax", {
              data: {
                page: sermonPage,
                book: $('#data-filter').attr('data-book'),
                topic: $('#data-filter').attr('data-topic')
              },
              success: function(response) {
                el.append(response).append($('#load-more-button'));
                return sermonPage++;
              },
              complete: function() {
                if ($('#pageCount').attr('data-totalcount') <= sermonPage * $('#pageCount').attr('data-pagecount')) {
                  return $('#load-more-button').fadeOut(0);
                } else {
                  return stopRunning = false;
                }
              }
            });
          }
        }
      });
    },
    expandSermonList: function() {
      var el, el2;
      el = $('.sermon-expand-button');
      el2 = '.sermon-series-list';
      $(el2).each(function() {
        return $(this).isShown = false;
      });
      return $('#sermon-list').on('click', '.sermon-expand-button', function(result) {
        if ($(this).parent().siblings(el2).attr('data-shown') === 'hidden') {
          $(el2).attr('data-shown', 'hidden');
          el.removeClass('series-selected');
          $(el2).slideUp();
          $(this).parent().siblings(el2).slideDown();
          $(this).parent().siblings(el2).attr('data-shown', 'shown');
          return $(this).addClass('series-selected');
        } else {
          $(this).parent().siblings(el2).slideUp();
          $(el2).attr('data-shown', 'hidden');
          return el.removeClass('series-selected');
        }
      });
    },
    sermonVideoPopup: function() {
      $('.view-video-link-overlay').each(function() {
        return $(this).click(function() {
          $('iframe').attr('src', $(this).attr('alt'));
          return $('.youtube, iframe').toggle();
        });
      });
      return $('.youtube').click(function() {
        $('.youtube, iframe').toggle();
        return $('iframe').attr('src', "");
      });
    }
  };

  $(document).ready(function() {
    Sermon.expandSermonList();
    Sermon.sermonVideoPopup();
    return Sermon.getMoreSermons();
  });

}).call(this);
